<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalles de Nacimientos en Pereira 2020</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>

</head>
<body>
    <header>
    <nav class="navbar">
      <div class="logo">üìä Datos Abiertos</div>
      <button class="menu-toggle">‚ò∞</button>
      <ul class="menu">
        <li><a href="index.html">Inicio</a></li>
        <li><a href="general.html">Estad√≠sticas Generales</a></li>
        <li><a href="detalles.html">An√°lisis Detallado</a></li>
        <li><a href="conclusiones.html">Conclusiones</a></li>
      </ul>
    </nav>
  </header>

  <h1>Detalles de los nacimientos en Pereira 2020 - 2024</h1>

  <!-- Selector de gr√°fico -->
  <label for="graficoSelect">Seleccione el gr√°fico:</label>
  <select id="graficoSelect">
    <option value="edad">Distribuci√≥n por edad de la madre</option>
    <option value="sexoRegimen">Distribuci√≥n de sexo seg√∫n r√©gimen de salud</option>
  </select>

  <!-- Contenedor -->
  <main class="details">
    <div class="chart-section">
      <div class="chart-explanation" id="explicacion">
        <h3 id="explicacionTitulo">T√≠tulo del gr√°fico</h3>
        <p id="explicacionTexto">Aqu√≠ aparecer√° autom√°ticamente una explicaci√≥n sobre el gr√°fico seleccionado.</p>
      </div>
      <div class="chart-box">
        <canvas id="graficoChart"></canvas>
      </div>
    </div>
  </main>

  <script>
    const graficoSelect = document.getElementById('graficoSelect');
    const ctx = document.getElementById('graficoChart').getContext('2d');
    let chart;

    // Referencias de explicaci√≥n
    const explicacionTitulo = document.getElementById("explicacionTitulo");
    const explicacionTexto = document.getElementById("explicacionTexto");

    // Diccionario de explicaciones
    const explicaciones = {
      edad: {
        titulo: "Distribuci√≥n por edad de la madre",
        texto: "Este gr√°fico muestra la cantidad de nacimientos seg√∫n la edad de la madre. Se observa una mayor concentraci√≥n entre los 18 y 25 a√±os, reflejando la etapa de mayor fertilidad en la poblaci√≥n."
      },
      sexoRegimen: {
        titulo: "Distribuci√≥n de sexo seg√∫n r√©gimen de salud",
        texto: "Este gr√°fico representa la distribuci√≥n de nacimientos entre hombres y mujeres seg√∫n el r√©gimen de salud (contributivo, subsidiado, no asegurado, excepci√≥n). Se aprecia que la mayor parte de los nacimientos corresponde al r√©gimen contributivo."
      }
    };

    function actualizarExplicacion(tipo) {
      explicacionTitulo.textContent = explicaciones[tipo].titulo;
      explicacionTexto.textContent = explicaciones[tipo].texto;
    }

    d3.dsv(";", "nacimientos_pereira2020_1.csv").then(data => {
      data.forEach(d => {
        let edadMatch = (d["Edad (a√±os)"] || "").trim().match(/^\d+/);
        d.EDAD = edadMatch ? +edadMatch[0] : NaN;
        d.SEXO = (d["Sexo"] || "").trim().toUpperCase();
        d.REGIMEN_SALUD = (d["Regimen Salud"] || "").trim().toUpperCase();
      });

      const datosValidos = data.filter(d => !isNaN(d.EDAD) && d.SEXO && d.REGIMEN_SALUD);

      // Datos edad
      let conteoEdad = d3.rollup(datosValidos, v => v.length, d => d.EDAD);
      let labelsEdad = Array.from(conteoEdad.keys()).sort((a,b)=>a-b);
      let valoresEdad = labelsEdad.map(e => conteoEdad.get(e));

      // Datos sexo-regimen
      let regimenes = Array.from(new Set(datosValidos.map(d => d.REGIMEN_SALUD)));
      let sexos = Array.from(new Set(datosValidos.map(d => d.SEXO)));

      let datasetsSexoRegimen = sexos.map((sexo,i)=>({
        label: sexo,
        data: regimenes.map(r => datosValidos.filter(d => d.SEXO===sexo && d.REGIMEN_SALUD===r).length),
        backgroundColor: i===0?'#36A2EB':'#FF6384'
      }));

      // Crear gr√°fico
      function crearGrafico(tipo) {
        let config;
        if(tipo === 'edad') {
          config = {
            type: 'bar',
            data: { labels: labelsEdad, datasets:[{
              label:'Nacimientos',
              data: valoresEdad,
              backgroundColor:'#FF9F40',
              borderColor:'#FF9F40',
              borderWidth:1,
              hoverBackgroundColor:'#FFA366'
            }]},
            options: {
              responsive:true,
              maintainAspectRatio:false,
              scales: { y: { beginAtZero:true } },
              plugins: { legend:{ display:false } }
            }
          };
        } else {
          config = {
            type:'bar',
            data:{ labels:regimenes, datasets:datasetsSexoRegimen },
            options:{
              responsive:true,
              maintainAspectRatio:false,
              plugins:{ tooltip:{ mode:'index', intersect:false } },
              scales:{ x:{ stacked:true }, y:{ stacked:true, beginAtZero:true } }
            }
          };
        }

        if(chart) {
          chart.destroy();
        }
        chart = new Chart(ctx, config);
      }

      // Inicializar por defecto
      crearGrafico(graficoSelect.value);
      actualizarExplicacion(graficoSelect.value);

      graficoSelect.addEventListener('change', () => {
        crearGrafico(graficoSelect.value);
        actualizarExplicacion(graficoSelect.value);
      });
    });
  </script>
</body>
</html>